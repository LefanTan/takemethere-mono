// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       String @id @default(uuid())
  // Will be used for users' unique link. Ex. takeme.blog/lefan
  username String @unique
  email    String @unique
  plan     PLAN   @default(FREE)

  page Page[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model Page {
  id          String      @id @default(uuid())
  user        User?       @relation(fields: [userId], references: [id])
  userId      String
  // Decide how the sections and links are categorized within the page
  // pageStructure Json
  pageEntries PageEntry[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model PageEntry {
  id String @id @default(uuid())

  linkId String?
  blogId String?

  link Link? @relation(fields: [linkId], references: [id])
  blog Blog? @relation(fields: [blogId], references: [id])

  Page   Page?   @relation(fields: [pageId], references: [id])
  pageId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model Link {
  id          String @id @default(uuid())
  displayText String
  link        String

  pageEntry PageEntry[]

  // Google Storage url
  mediaUrl         String?
  entryAnalyticsId String          @unique
  entryAnalytics   EntryAnalytics? @relation(fields: [entryAnalyticsId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model Blog {
  id           String  @id @default(uuid())
  name         String
  rating       Float?
  location     String?
  externalLink String?

  pageEntry PageEntry[]

  entryAnalyticsId String          @unique
  entryAnalytics   EntryAnalytics? @relation(fields: [entryAnalyticsId], references: [id])

  // Google Storage url
  mediaUrl       String?
  lifetimeClicks Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

// Analytics for individual link/blogs
model EntryAnalytics {
  id             String @id @default(uuid())
  lifetimeClicks Int    @default(0)

  blog Blog?
  link Link?
}

enum PLAN {
  FREE
  PREMIUM
}
