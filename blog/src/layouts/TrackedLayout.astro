---
/**
 * TrackedLayout - Layout to be used on all TakeMe Links
 * 1. SEO optimized
 * 2. Contains analytic script
 */

export interface Props {
  user: User;
}

import { User } from "@common/types";
import SEO from "@components/SEO.astro";
import BaseLayout from "./BaseLayout.astro";

const prod = import.meta.env.PROD;

const { user } = Astro.props;
---

<BaseLayout>
  <!-- Goes into header -->
  <!-- TODO: Replace with hardcoded url with vanity url -->
  <SEO
    slot="header"
    title={`${user.username} | TakeMe - Link in Bio tool for Bloggers`}
    description={user.bio}
    image={user.profileMediaUrl
      ? `${user.profileMediaUrl?.split(".webp")[0]}-large.webp`
      : undefined}
    url={`https://takeme.blog/${user.username}`}
  />

  <!-- Main content -->
  <slot />

  <!-- Goes after main content/slot -->

  <script slot="append" type="module" define:vars={{ uid: user.id, prod }}>
    window.uid = uid;
    window.production = prod;

    const params = new URLSearchParams(window.location.search);
    const isPreview = !!params.get("preview");

    initializeTracker(window.uid, window.production, isPreview);
  </script>
</BaseLayout>
